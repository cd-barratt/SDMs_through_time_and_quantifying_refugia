library(raster)
library(rgdal)
library(sp)
library(maptools)
library(SDMTools)

setwd('') # change this directory to where you download this DRYAD dataset

dir.create('./model_outputs/tiff')
verus = readOGR('./map_data/P_t_verus.shp')
elliotti = readOGR('./map_data/P_t_ellioti.shp')
troglodytes = readOGR('./map_data/P_t_troglodytes.shp')
schweinfurthii = readOGR('./map_data/P_t_schweinfurthii.shp')
refugia = readOGR('./map_data/REFUGIA_MALEY96.shp')
panaf_sites = readOGR('./map_data/all_panaf_sites.shp')
shp <- readOGR('./map_data/countries_clipped_raster_extent.shp')

#define image grid
image.grid = function(tasc,tfile,zlim=NULL,cols=NULL) {
  #plot the image
  tiff(tfile,height=600/100,width=1080/100,units='cm',res=500,pointsize=5)
  layout(matrix(c(rep(rep(1,8),6),1,2,2,2,2,1,1,1),nr=7,nc=8,byrow=TRUE))
  par(mar=c(0,0,0,0),cex=1)
  if (is.null(zlim)) { zlim = range(as.vector(tasc),na.rm=T) }
  image(tasc,ann=FALSE,axes=FALSE,zlim=zlim,col=cols, xlim=c(-18,32), ylim=c(-12,16))
  legend.gradient(cbind(c(-14,-13.5,-13.5,-14),c(-7,-7,0,0)),limits=cbind(0,1),title='Habitat Suitability',cols=cols,cex=1.2) # limits originally limits=round(zlim,2)
  plot(shp,add=T,border="black",pbg="transparent",lwd=0.08) #add the subregions		
  plot(verus,add=T,border="green",pbg="transparent",lwd=0.7)
  plot(elliotti,add=T,border="green",pbg="transparent",lwd=0.7)
  plot(troglodytes,add=T,border="green",pbg="transparent",lwd=0.7)
  plot(schweinfurthii,add=T,border="green",pbg="transparent",lwd=0.7)
  plot(refugia,add=T,border="black",pbg="black",lwd=0.6, lty=6)
  #points(panaf_sites, pch=19, cex=0.3)
    dev.off()
}

cols = c(colorRampPalette(c("#313695","#35429B","#394FA1","#3D5CA7","#4169AE","#4576B4","#4F81BA","#598DC0","#6298C6","#6CA3CC"))(45),colorRampPalette(c("#76AED1","#81B7D6","#8CC0DB","#97C9E0","#A3D2E5","#AEDAE9","#B9DFEC","#C3E5F0","#CEEAF3","#D9EFF6"))(35),colorRampPalette(c("#E2F3F3","#E8F6E7","#EFF8DC","#F5FBD0","#FBFDC4","#FEFBBA","#FEF5B0","#FEEFA7","#FEE89D","#FEE293"))(15),colorRampPalette(c("#FDD98A","#FDCF80","#FDC577","#FDBB6D","#FDB163","#FBA45C","#F99756","#F88A50","#F67C4A","#F46F44"))(8),colorRampPalette(c("#EF633E","#E95638","#E34A33","#DD3D2D","#D73127","#CD2726","#C31D26","#B91326","#AF0926","#A50026"))(5))

setwd('./model_outputs/asc/')
timeslice_000 <- raster("000.asc") 
timeslice_001 <- raster("001.asc")
timeslice_002 <- raster("002.asc")
timeslice_003 <- raster("003.asc")
timeslice_004 <- raster("004.asc")
timeslice_005 <- raster("005.asc")
timeslice_006 <- raster("006.asc")
timeslice_007 <- raster("007.asc")
timeslice_008 <- raster("008.asc") 
timeslice_009 <- raster("009.asc")
timeslice_010 <- raster("010.asc")
timeslice_011 <- raster("011.asc") 
timeslice_012 <- raster("012.asc")
timeslice_013 <- raster("013.asc")
timeslice_014 <- raster("014.asc")
timeslice_015 <- raster("015.asc")
timeslice_016 <- raster("016.asc")
timeslice_017 <- raster("017.asc")
timeslice_018 <- raster("018.asc") 
timeslice_019 <- raster("019.asc")
timeslice_020 <- raster("020.asc")
timeslice_021 <- raster("021.asc")
timeslice_022 <- raster("022.asc")
timeslice_024 <- raster("024.asc")
timeslice_026 <- raster("026.asc")
timeslice_028 <- raster("028.asc")
timeslice_030 <- raster("030.asc")
timeslice_032 <- raster("032.asc")
timeslice_034 <- raster("034.asc")
timeslice_036 <- raster("036.asc")
timeslice_038 <- raster("038.asc")
timeslice_040 <- raster("040.asc")
timeslice_042 <- raster("042.asc")
timeslice_044 <- raster("044.asc")
timeslice_046 <- raster("046.asc")
timeslice_048 <- raster("048.asc")
timeslice_050 <- raster("050.asc")
timeslice_052 <- raster("052.asc")
timeslice_054 <- raster("054.asc")
timeslice_056 <- raster("056.asc")
timeslice_058 <- raster("058.asc")
timeslice_060 <- raster("060.asc")
timeslice_062 <- raster("062.asc")
timeslice_064 <- raster("064.asc")
timeslice_066 <- raster("066.asc")
timeslice_068 <- raster("068.asc")
timeslice_070 <- raster("070.asc")
timeslice_072 <- raster("072.asc")
timeslice_074 <- raster("074.asc")
timeslice_076 <- raster("076.asc")
timeslice_078 <- raster("078.asc")
timeslice_080 <- raster("080.asc")
timeslice_084 <- raster("084.asc")
timeslice_088 <- raster("088.asc")
timeslice_092 <- raster("092.asc")
timeslice_096 <- raster("096.asc")
timeslice_100 <- raster("100.asc")
timeslice_104 <- raster("104.asc")
timeslice_108 <- raster("108.asc")
timeslice_112 <- raster("112.asc")
timeslice_116 <- raster("116.asc")
timeslice_120 <- raster("120.asc")

image.grid(timeslice_000,'../tiff/000.tiff',col=cols)
image.grid(timeslice_001,'../tiff/001.tiff',col=cols)
image.grid(timeslice_002,'../tiff/002.tiff',col=cols)
image.grid(timeslice_003,'../tiff/003.tiff',col=cols)
image.grid(timeslice_004,'../tiff/004.tiff',col=cols)
image.grid(timeslice_005,'../tiff/005.tiff',col=cols)
image.grid(timeslice_006,'../tiff/006.tiff',col=cols)
image.grid(timeslice_007,'../tiff/007.tiff',col=cols)
image.grid(timeslice_008,'../tiff/008.tiff',col=cols)
image.grid(timeslice_009,'../tiff/009.tiff',col=cols)
image.grid(timeslice_010,'../tiff/010.tiff',col=cols)
image.grid(timeslice_011,'../tiff/011.tiff',col=cols)
image.grid(timeslice_012,'../tiff/012.tiff',col=cols)
image.grid(timeslice_013,'../tiff/013.tiff',col=cols)
image.grid(timeslice_014,'../tiff/014.tiff',col=cols)
image.grid(timeslice_015,'../tiff/015.tiff',col=cols)
image.grid(timeslice_016,'../tiff/016.tiff',col=cols)
image.grid(timeslice_017,'../tiff/017.tiff',col=cols)
image.grid(timeslice_018,'../tiff/018.tiff',col=cols)
image.grid(timeslice_019,'../tiff/019.tiff',col=cols)
image.grid(timeslice_020,'../tiff/020.tiff',col=cols)
image.grid(timeslice_021,'../tiff/021.tiff',col=cols)
image.grid(timeslice_022,'../tiff/022.tiff',col=cols)
image.grid(timeslice_024,'../tiff/024.tiff',col=cols)
image.grid(timeslice_026,'../tiff/026.tiff',col=cols)
image.grid(timeslice_028,'../tiff/028.tiff',col=cols)
image.grid(timeslice_030,'../tiff/030.tiff',col=cols)
image.grid(timeslice_032,'../tiff/032.tiff',col=cols)
image.grid(timeslice_034,'../tiff/034.tiff',col=cols)
image.grid(timeslice_036,'../tiff/036.tiff',col=cols)
image.grid(timeslice_038,'../tiff/038.tiff',col=cols)
image.grid(timeslice_040,'../tiff/040.tiff',col=cols)
image.grid(timeslice_042,'../tiff/042.tiff',col=cols)
image.grid(timeslice_044,'../tiff/044.tiff',col=cols)
image.grid(timeslice_046,'../tiff/046.tiff',col=cols)
image.grid(timeslice_048,'../tiff/048.tiff',col=cols)
image.grid(timeslice_050,'../tiff/050.tiff',col=cols)
image.grid(timeslice_052,'../tiff/052.tiff',col=cols)
image.grid(timeslice_054,'../tiff/054.tiff',col=cols)
image.grid(timeslice_056,'../tiff/056.tiff',col=cols)
image.grid(timeslice_058,'../tiff/058.tiff',col=cols)
image.grid(timeslice_060,'../tiff/060.tiff',col=cols)
image.grid(timeslice_062,'../tiff/062.tiff',col=cols)
image.grid(timeslice_064,'../tiff/064.tiff',col=cols)
image.grid(timeslice_066,'../tiff/066.tiff',col=cols)
image.grid(timeslice_068,'../tiff/068.tiff',col=cols)
image.grid(timeslice_070,'../tiff/070.tiff',col=cols)
image.grid(timeslice_072,'../tiff/072.tiff',col=cols)
image.grid(timeslice_074,'../tiff/074.tiff',col=cols)
image.grid(timeslice_076,'../tiff/076.tiff',col=cols)
image.grid(timeslice_078,'../tiff/078.tiff',col=cols)
image.grid(timeslice_080,'../tiff/080.tiff',col=cols)
image.grid(timeslice_084,'../tiff/084.tiff',col=cols)
image.grid(timeslice_088,'../tiff/088.tiff',col=cols)
image.grid(timeslice_092,'../tiff/092.tiff',col=cols)
image.grid(timeslice_096,'../tiff/096.tiff',col=cols)
image.grid(timeslice_100,'../tiff/100.tiff',col=cols)
image.grid(timeslice_104,'../tiff/104.tiff',col=cols)
image.grid(timeslice_108,'../tiff/108.tiff',col=cols)
image.grid(timeslice_112,'../tiff/112.tiff',col=cols)
image.grid(timeslice_116,'../tiff/116.tiff',col=cols)
image.grid(timeslice_120,'../tiff/120.tiff',col=cols)

# Now merge them into a animated GIF image
library(magick)
library(raster)
library(rgdal)

tiff.dir = '../../model_outputs/tiff/'

timeslice_000 <- image_read(paste0(tiff.dir, ("000.tiff")))
timeslice_001 <- image_read(paste0(tiff.dir, ("001.tiff")))
timeslice_002 <- image_read(paste0(tiff.dir, ("002.tiff")))
timeslice_003 <- image_read(paste0(tiff.dir, ("003.tiff")))
timeslice_004 <- image_read(paste0(tiff.dir, ("004.tiff")))
timeslice_005 <- image_read(paste0(tiff.dir, ("005.tiff")))
timeslice_006 <- image_read(paste0(tiff.dir, ("006.tiff")))
timeslice_007 <- image_read(paste0(tiff.dir, ("007.tiff")))
timeslice_008 <- image_read(paste0(tiff.dir, ("008.tiff"))) 
timeslice_009 <- image_read(paste0(tiff.dir, ("009.tiff")))
timeslice_010 <- image_read(paste0(tiff.dir, ("010.tiff")))
timeslice_011 <- image_read(paste0(tiff.dir, ("011.tiff"))) 
timeslice_012 <- image_read(paste0(tiff.dir, ("012.tiff")))
timeslice_013 <- image_read(paste0(tiff.dir, ("013.tiff")))
timeslice_014 <- image_read(paste0(tiff.dir, ("014.tiff")))
timeslice_015 <- image_read(paste0(tiff.dir, ("015.tiff")))
timeslice_016 <- image_read(paste0(tiff.dir, ("016.tiff")))
timeslice_017 <- image_read(paste0(tiff.dir, ("017.tiff")))
timeslice_018 <- image_read(paste0(tiff.dir, ("018.tiff"))) 
timeslice_019 <- image_read(paste0(tiff.dir, ("019.tiff")))
timeslice_020 <- image_read(paste0(tiff.dir, ("020.tiff")))
timeslice_021 <- image_read(paste0(tiff.dir, ("021.tiff")))
timeslice_022 <- image_read(paste0(tiff.dir, ("022.tiff")))
timeslice_024 <- image_read(paste0(tiff.dir, ("024.tiff")))
timeslice_026 <- image_read(paste0(tiff.dir, ("026.tiff")))
timeslice_028 <- image_read(paste0(tiff.dir, ("028.tiff")))
timeslice_030 <- image_read(paste0(tiff.dir, ("030.tiff")))
timeslice_032 <- image_read(paste0(tiff.dir, ("032.tiff")))
timeslice_034 <- image_read(paste0(tiff.dir, ("034.tiff")))
timeslice_036 <- image_read(paste0(tiff.dir, ("036.tiff")))
timeslice_038 <- image_read(paste0(tiff.dir, ("038.tiff")))
timeslice_040 <- image_read(paste0(tiff.dir, ("040.tiff")))
timeslice_042 <- image_read(paste0(tiff.dir, ("042.tiff")))
timeslice_044 <- image_read(paste0(tiff.dir, ("044.tiff")))
timeslice_046 <- image_read(paste0(tiff.dir, ("046.tiff")))
timeslice_048 <- image_read(paste0(tiff.dir, ("048.tiff")))
timeslice_050 <- image_read(paste0(tiff.dir, ("050.tiff")))
timeslice_052 <- image_read(paste0(tiff.dir, ("052.tiff")))
timeslice_054 <- image_read(paste0(tiff.dir, ("054.tiff")))
timeslice_056 <- image_read(paste0(tiff.dir, ("056.tiff")))
timeslice_058 <- image_read(paste0(tiff.dir, ("058.tiff")))
timeslice_060 <- image_read(paste0(tiff.dir, ("060.tiff")))
timeslice_062 <- image_read(paste0(tiff.dir, ("062.tiff")))
timeslice_064 <- image_read(paste0(tiff.dir, ("064.tiff")))
timeslice_066 <- image_read(paste0(tiff.dir, ("066.tiff")))
timeslice_068 <- image_read(paste0(tiff.dir, ("068.tiff")))
timeslice_070 <- image_read(paste0(tiff.dir, ("070.tiff")))
timeslice_072 <- image_read(paste0(tiff.dir, ("072.tiff")))
timeslice_074 <- image_read(paste0(tiff.dir, ("074.tiff")))
timeslice_076 <- image_read(paste0(tiff.dir, ("076.tiff")))
timeslice_078 <- image_read(paste0(tiff.dir, ("078.tiff")))
timeslice_080 <- image_read(paste0(tiff.dir, ("080.tiff")))
timeslice_084 <- image_read(paste0(tiff.dir, ("084.tiff")))
timeslice_088 <- image_read(paste0(tiff.dir, ("088.tiff")))
timeslice_092 <- image_read(paste0(tiff.dir, ("092.tiff")))
timeslice_096 <- image_read(paste0(tiff.dir, ("096.tiff")))
timeslice_100 <- image_read(paste0(tiff.dir, ("100.tiff")))
timeslice_104 <- image_read(paste0(tiff.dir, ("104.tiff")))
timeslice_108 <- image_read(paste0(tiff.dir, ("108.tiff")))
timeslice_112 <- image_read(paste0(tiff.dir, ("112.tiff")))
timeslice_116 <- image_read(paste0(tiff.dir, ("116.tiff")))
timeslice_120 <- image_read(paste0(tiff.dir, ("120.tiff")))

timeslice_000 <- image_annotate(timeslice_000, "Time: Present", size = 44, location = "+170+540", color = "black")
timeslice_001 <- image_annotate(timeslice_001, "Time: 001 kya", size = 44, location = "+170+540", color = "black")
timeslice_002 <- image_annotate(timeslice_002, "Time: 002 kya ", size = 44, location = "+170+540", color = "black")
timeslice_003 <- image_annotate(timeslice_003, "Time: 003 kya ", size = 44, location = "+170+540", color = "black")
timeslice_004 <- image_annotate(timeslice_004, "Time: 004 kya ", size = 44, location = "+170+540", color = "black")
timeslice_005 <- image_annotate(timeslice_005, "Time: 005 kya ", size = 44, location = "+170+540", color = "black")
timeslice_006 <- image_annotate(timeslice_006, "Time: 006 kya ", size = 44, location = "+170+540", color = "black")
timeslice_007 <- image_annotate(timeslice_007, "Time: 007 kya ", size = 44, location = "+170+540", color = "black")
timeslice_008 <- image_annotate(timeslice_008, "Time: 008 kya ", size = 44, location = "+170+540", color = "black")
timeslice_009 <- image_annotate(timeslice_009, "Time: 009 kya ", size = 44, location = "+170+540", color = "black")
timeslice_010 <- image_annotate(timeslice_010, "Time: 010 kya ", size = 44, location = "+170+540", color = "black")
timeslice_011 <- image_annotate(timeslice_011, "Time: 011 kya ", size = 44, location = "+170+540", color = "black")
timeslice_012 <- image_annotate(timeslice_012, "Time: 012 kya ", size = 44, location = "+170+540", color = "black")
timeslice_013 <- image_annotate(timeslice_013, "Time: 013 kya ", size = 44, location = "+170+540", color = "black")
timeslice_014 <- image_annotate(timeslice_014, "Time: 014 kya ", size = 44, location = "+170+540", color = "black")
timeslice_015 <- image_annotate(timeslice_015, "Time: 015 kya ", size = 44, location = "+170+540", color = "black")
timeslice_016 <- image_annotate(timeslice_016, "Time: 016 kya ", size = 44, location = "+170+540", color = "black")
timeslice_017 <- image_annotate(timeslice_017, "Time: 017 kya ", size = 44, location = "+170+540", color = "black")
timeslice_018 <- image_annotate(timeslice_018, "Time: 018 kya ", size = 44, location = "+170+540", color = "black")
timeslice_019 <- image_annotate(timeslice_019, "Time: 019 kya ", size = 44, location = "+170+540", color = "black")
timeslice_020 <- image_annotate(timeslice_020, "Time: 020 kya ", size = 44, location = "+170+540", color = "black")
timeslice_021 <- image_annotate(timeslice_021, "Time: 021 kya ", size = 44, location = "+170+540", color = "black")
timeslice_022 <- image_annotate(timeslice_022, "Time: 022 kya ", size = 44, location = "+170+540", color = "black")
timeslice_024 <- image_annotate(timeslice_024, "Time: 024 kya ", size = 44, location = "+170+540", color = "black")
timeslice_026 <- image_annotate(timeslice_026, "Time: 026 kya ", size = 44, location = "+170+540", color = "black")
timeslice_028 <- image_annotate(timeslice_028, "Time: 028 kya ", size = 44, location = "+170+540", color = "black")
timeslice_030 <- image_annotate(timeslice_030, "Time: 030 kya ", size = 44, location = "+170+540", color = "black")
timeslice_032 <- image_annotate(timeslice_032, "Time: 032 kya ", size = 44, location = "+170+540", color = "black")
timeslice_034 <- image_annotate(timeslice_034, "Time: 034 kya ", size = 44, location = "+170+540", color = "black")
timeslice_036 <- image_annotate(timeslice_036, "Time: 036 kya ", size = 44, location = "+170+540", color = "black")
timeslice_038 <- image_annotate(timeslice_038, "Time: 038 kya ", size = 44, location = "+170+540", color = "black")
timeslice_040 <- image_annotate(timeslice_040, "Time: 040 kya ", size = 44, location = "+170+540", color = "black")
timeslice_042 <- image_annotate(timeslice_042, "Time: 042 kya ", size = 44, location = "+170+540", color = "black")
timeslice_044 <- image_annotate(timeslice_044, "Time: 044 kya ", size = 44, location = "+170+540", color = "black")
timeslice_046 <- image_annotate(timeslice_046, "Time: 046 kya ", size = 44, location = "+170+540", color = "black")
timeslice_048 <- image_annotate(timeslice_048, "Time: 048 kya ", size = 44, location = "+170+540", color = "black")
timeslice_050 <- image_annotate(timeslice_050, "Time: 050 kya ", size = 44, location = "+170+540", color = "black")
timeslice_052 <- image_annotate(timeslice_052, "Time: 052 kya ", size = 44, location = "+170+540", color = "black")
timeslice_054 <- image_annotate(timeslice_054, "Time: 054 kya ", size = 44, location = "+170+540", color = "black")
timeslice_056 <- image_annotate(timeslice_056, "Time: 056 kya ", size = 44, location = "+170+540", color = "black")
timeslice_058 <- image_annotate(timeslice_058, "Time: 058 kya ", size = 44, location = "+170+540", color = "black")
timeslice_060 <- image_annotate(timeslice_060, "Time: 060 kya ", size = 44, location = "+170+540", color = "black")
timeslice_062 <- image_annotate(timeslice_062, "Time: 062 kya ", size = 44, location = "+170+540", color = "black")
timeslice_064 <- image_annotate(timeslice_064, "Time: 064 kya ", size = 44, location = "+170+540", color = "black")
timeslice_066 <- image_annotate(timeslice_066, "Time: 066 kya ", size = 44, location = "+170+540", color = "black")
timeslice_068 <- image_annotate(timeslice_068, "Time: 068 kya ", size = 44, location = "+170+540", color = "black")
timeslice_070 <- image_annotate(timeslice_070, "Time: 070 kya ", size = 44, location = "+170+540", color = "black")
timeslice_072 <- image_annotate(timeslice_072, "Time: 072 kya ", size = 44, location = "+170+540", color = "black")
timeslice_074 <- image_annotate(timeslice_074, "Time: 074 kya ", size = 44, location = "+170+540", color = "black")
timeslice_076 <- image_annotate(timeslice_076, "Time: 076 kya ", size = 44, location = "+170+540", color = "black")
timeslice_078 <- image_annotate(timeslice_078, "Time: 078 kya ", size = 44, location = "+170+540", color = "black")
timeslice_080 <- image_annotate(timeslice_080, "Time: 080 kya ", size = 44, location = "+170+540", color = "black")
timeslice_084 <- image_annotate(timeslice_084, "Time: 084 kya ", size = 44, location = "+170+540", color = "black")
timeslice_088 <- image_annotate(timeslice_088, "Time: 088 kya ", size = 44, location = "+170+540", color = "black")
timeslice_092 <- image_annotate(timeslice_092, "Time: 092 kya ", size = 44, location = "+170+540", color = "black")
timeslice_096 <- image_annotate(timeslice_096, "Time: 096 kya ", size = 44, location = "+170+540", color = "black")
timeslice_100 <- image_annotate(timeslice_100, "Time: 100 kya ", size = 44, location = "+170+540", color = "black")
timeslice_104 <- image_annotate(timeslice_104, "Time: 104 kya ", size = 44, location = "+170+540", color = "black")
timeslice_108 <- image_annotate(timeslice_108, "Time: 108 kya ", size = 44, location = "+170+540", color = "black")
timeslice_112 <- image_annotate(timeslice_112, "Time: 112 kya ", size = 44, location = "+170+540", color = "black")
timeslice_116 <- image_annotate(timeslice_116, "Time: 116 kya ", size = 44, location = "+170+540", color = "black")
timeslice_120 <- image_annotate(timeslice_120, "Time: 120 kya ", size = 44, location = "+170+540", color = "black")


# animate 
frames <- c(timeslice_000, timeslice_001, timeslice_002, timeslice_003, timeslice_004, timeslice_005, timeslice_006, timeslice_007, timeslice_008, 
            timeslice_009, timeslice_010, timeslice_011, timeslice_012, timeslice_013, timeslice_014, timeslice_015, timeslice_016, timeslice_017, 
            timeslice_018, timeslice_019, timeslice_020, timeslice_021, timeslice_022, timeslice_024, timeslice_026, timeslice_028, timeslice_030, 
            timeslice_032, timeslice_034, timeslice_036, timeslice_038, timeslice_040, timeslice_042, timeslice_044, timeslice_046, timeslice_048, 
            timeslice_050, timeslice_052, timeslice_054, timeslice_056, timeslice_058, timeslice_060, timeslice_062, timeslice_064, timeslice_066, 
            timeslice_068, timeslice_070, timeslice_072, timeslice_074, timeslice_076, timeslice_078, timeslice_080, timeslice_084, timeslice_088, 
            timeslice_092, timeslice_096, timeslice_100, timeslice_104, timeslice_108, timeslice_112, timeslice_116, timeslice_120)
animation <- image_animate(frames, fps = 4)
image_write(animation, "../../figures/Animated_gif.gif")














